<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kv√≠zov√° aplikace</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #f0f8ff;
            max-width: 800px;
            margin: 0 auto;
        }

        h1 {
            color: #2c5530;
            margin-bottom: 10px;
        }

        /* TLAƒå√çTKA - OBECN√â STYLY */
        button {
            padding: 20px;
            font-size: 18px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        button:hover {
            background-color: #45a049;
            transform: translateY(-2px);
        }

        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
        }

        /* MENU A TLAƒå√çTKA KVIZ≈Æ */
        .quiz-menu {
            text-align: center;
            padding: 40px 20px;
        }

        .quiz-header {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            min-height: 60px; /* P≈ôid√°no pro konzistenci */
        }

        .quiz-button {
            padding: 20px 40px;
            font-size: 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            margin: 15px;
            transition: all 0.3s;
            min-width: 200px;
        }

        .quiz-button:hover {
            background-color: #45a049;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }

        .menu-return-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #ff9800;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .menu-return-button:hover {
            background-color: #f57c00;
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        /* HLAVN√ç KVIZOV√Å PLOCHA */
        .score-container {
            font-size: 20px;
            padding: 10px;
            background-color: #e8f5e9;
            border-radius: 10px;
            display: block;
            margin: 0 auto 20px auto;
            width: fit-content;
            max-width: 90%;
        }

        .quiz-container {
            position: relative;
            display: inline-block;
            text-align: center;
            margin: 20px 0;
            max-width: 100%;
        }

        .quiz-image {
            max-width: 100%;
            max-height: 400px;
            width: auto;
            height: auto;
            border-radius: 15px;
            border: 4px solid #2c5530;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            display: block;
        }

        /* HINT IKONA A TOOLTIP */
        .hint-icon {
            position: absolute;
            bottom: 15px;
            right: 15px;
            width: 40px;
            height: 40px;
            cursor: help;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            padding: 5px;
            transition: all 0.3s;
            border: 2px solid #2c5530;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            z-index: 10;
        }

        .hint-icon:hover {
            background-color: rgba(255, 255, 255, 1);
            transform: scale(1.1);
        }

        .hint-tooltip {
            visibility: hidden;
            position: absolute;
            bottom: 60px;
            right: 0;
            background-color: #333;
            color: white;
            padding: 15px;
            border-radius: 10px;
            width: 250px;
            z-index: 100;
            font-size: 14px;
            line-height: 1.4;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .hint-tooltip::after {
            content: "";
            position: absolute;
            top: 100%;
            right: 15px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }

        .hint-icon:hover + .hint-tooltip {
            visibility: visible;
        }

        /* CREDIT IKONA A TOOLTIP */
        .credit-icon {
            position: absolute;
            bottom: 15px;
            left: 15px;
            width: 30px;
            height: 30px;
            cursor: help;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            padding: 5px;
            transition: all 0.3s;
            border: 2px solid #666;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 16px;
            font-weight: bold;
            color: #666;
            z-index: 10;
        }

        .credit-icon:hover {
            background-color: rgba(255, 255, 255, 1);
            transform: scale(1.1);
            border-color: #333;
            color: #333;
        }

        .credit-tooltip {
            visibility: hidden;
            position: absolute;
            bottom: 50px;
            left: 0;
            background-color: #333;
            color: white;
            padding: 12px;
            border-radius: 8px;
            width: 300px;
            max-width: 80vw;
            z-index: 100;
            font-size: 12px;
            line-height: 1.3;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .credit-tooltip::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 15px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }

        .credit-icon:hover + .credit-tooltip {
            visibility: visible;
        }

        /* MO≈ΩNOSTI ODPOVƒöD√ç */
        .options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            max-width: 600px;
            margin: 20px auto;
        }

        .options button {
            padding: 15px 10px;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            line-height: 1.3;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* FEEDBACK A V√ùSLEDKY */
        .feedback {
            font-size: 28px;
            font-weight: bold;
            margin: 25px 0;
            height: 50px;
        }

        .correct {
            color: #2e7d32;
        }

        .incorrect {
            color: #c62828;
        }

        /* TLAƒå√çTKA V√ùSLEDK≈Æ */
        .result-button {
            padding: 15px 30px; 
            font-size: 18px; 
            color: white; 
            border: none; 
            border-radius: 10px; 
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
            min-width: 200px;
        }

        .result-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .restart-button {
            background-color: #4CAF50;
        }

        .menu-button {
            background-color: #2196F3;
        }

        /* V√ùSLEDKOV√Å OBRAZOVKA */
        #quizResults {
            display: none;
            text-align: center;
            padding: 50px 20px;
        }

        /* DOPL≈áUJ√çC√ç STYLY */
        .scientific-name {
            font-size: 12px;
            font-style: italic;
            opacity: 0.9;
            display: block;
            margin-top: 2px;
        }
        
        /* STYLY PRO ƒå√çSELN√çK */
        .question-counter {
            margin: 25px 0;
            padding: 15px;
            background-color: var(--score-bg);
            border-radius: 10px;
            display: inline-block;
        }

        .counter-display {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
            padding: 10px 20px;
            background-color: white;
            border-radius: 8px;
            border: 2px solid var(--border-color);
            min-width: 100px;
            display: inline-block;
            position: relative;
        }

        .counter-input {
            width: 60px;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            border: none;
            background: transparent;
            outline: none;
            display: none; /* Skryt√© jako v√Ωchoz√≠ */
        }

        .counter-input:focus {
            background-color: #f0f8ff;
            border-radius: 4px;
        }

        /* Skryt√≠ ≈°ipeƒçek v Chrome, Safari, Edge, Opera */
        .counter-input::-webkit-outer-spin-button,
        .counter-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .counter-text {
            display: inline-block;
            min-width: 40px;
            text-align: center;
            cursor: pointer;
            padding: 2px 5px;
        }

        .counter-text:hover {
            background-color: #f0f8ff;
            border-radius: 4px;
        }

        .counter-button {
            padding: 10px 15px;
            font-size: 18px;
            margin: 0 5px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .counter-button:hover {
            background-color: var(--primary-hover);
            transform: translateY(-2px);
        }

        .max-button {
            background-color: var(--secondary-color);
        }

        .max-button:hover {
            background-color: #0b7dda;
        }
        
        /* V√ùBƒöR JAZYKA */
        .language-selector {
            position: absolute;
            top: 20px;
            right: 20px;
        }
     
        .language-button {
            padding: 8px 15px;
            font-size: 14px;
            background-color: #666;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 2px;
        } 
        
        .language-button.active {
            background-color: #2196F3;
        }

        /* V√Ωbƒõr svƒõtle/tmav√©ho re≈æimu podle preferenc√≠ u≈æivatele */
        :root {
            /* SVƒöTL√â T√âMA (v√Ωchoz√≠) */
            --bg-color: #f0f8ff;
            --text-color: #333;
            --card-bg: #ffffff;
            --primary-color: #4CAF50;
            --primary-hover: #45a049;
            --secondary-color: #2196F3;
            --score-bg: #e8f5e9;
            --border-color: #2c5530;
            --shadow: rgba(0,0,0,0.2);
        }

        [data-theme="dark"] {
            /* TMAV√â T√âMA */
            --bg-color: #1a1a2e;
            --text-color: #e6e6e6;
            --card-bg: #16213e;
            --primary-color: #389738;
            --primary-hover: #2e7d32;
            --secondary-color: #1976d2;
            --score-bg: #2d3748;
            --border-color: #4a6572;
            --shadow: rgba(0,0,0,0.5);
        }

        .theme-selector {
            position: absolute;
            top: 20px;
            left: 20px;
        }

        /* Aplikuj promƒõnn√© na elementy */
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .quiz-menu, .quiz-container, #quizResults {
            background-color: var(--card-bg);
        }

        button {
            background-color: var(--primary-color);
        }

        button:hover {
            background-color: var(--primary-hover);
        }

        .menu-button {
            background-color: var(--secondary-color);
        }

        .score-container, .question-counter {
            background-color: var(--score-bg);
        }

        .quiz-image {
            border-color: var(--border-color);
        }

        /* TLAƒå√çTKO PRO P≈òEP√çN√ÅN√ç T√âMATU */
        .theme-toggle {
            position: absolute;
            top: 20px;
            left: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .theme-toggle:hover {
            background-color: var(--score-bg);
            transform: scale(1.1);
        }

        /* STYLY PRO V√ùBƒöR SKUPIN */
        .group-selection-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-color);
            z-index: 100;
            overflow-y: auto;
            padding: 20px;
            box-sizing: border-box;
        }

        .group-selection-content {
            max-width: 800px;
            margin: 0 auto;
            background-color: var(--card-bg);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 8px 25px var(--shadow);
            text-align: center;
        }

        .group-buttons-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
        }

        .group-buttons-container button {
            padding: 18px 25px;
            font-size: 16px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 200px;
            text-align: center;
            box-shadow: 0 4px 8px var(--shadow);
        }

        .group-buttons-container button:hover {
            background-color: var(--primary-hover);
            transform: translateY(-3px);
            box-shadow: 0 6px 12px var(--shadow);
        }

        .group-selection-footer {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        /* NOV√â STYLY PRO KVIZ S PSAN√çM */
        .write-quiz-container {
            display: none;
            text-align: center;
            max-width: 600px;
            margin: 0 auto;
        }

        .answer-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .answer-controls button {
            padding: 15px 25px;
            font-size: 18px;
            border-radius: 10px;
            min-width: 120px;
        }

        .show-answer-button {
            background-color: #2196F3;
        }

        .correct-button {
            background-color: #4CAF50;
        }

        .incorrect-button {
            background-color: #f44336;
        }

        .drawing-container {
            margin: 20px 0;
            border: 2px solid rgb(76, 175, 80); 
            border-radius: 10px;
            background-color: white;
            position: relative;
            overflow: hidden;
        }

        #drawingCanvas {
            width: 100%;
            height: 200px;
            display: block;
            cursor: crosshair;
            touch-action: none; /* D≈Øle≈æit√© pro dotykov√° za≈ô√≠zen√≠ */
        }

        .drawing-tools {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }

        .drawing-tools button {
            padding: 8px 15px;
            font-size: 14px;
        }

        .clear-button {
            background-color: #ff9800;
        }

        .answer-display {
            margin: 20px 0;
            padding: 30px;
            background-color: var(--score-bg);
            border-radius: 15px;
            border: 3px solid var(--border-color);
            display: none;
        }

        .answer-text {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--text-color);
        }

        .answer-latin {
            font-size: 20px;
            font-style: italic;
            margin-bottom: 15px;
            color: #666;
        }

        .answer-description {
            font-size: 18px;
            color: var(--text-color);
            line-height: 1.4;
        }

        .evaluation-buttons {
            display: none;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }

        .evaluation-buttons button {
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 10px;
            min-width: 140px;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- P≈òIHL√Å≈†EN√ç -->
    <div id="loginScreen" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; z-index: 1000;">
        <div style="background: white; padding: 40px; border-radius: 15px; text-align: center; box-shadow: 0 4px 20px rgba(0,0,0,0.3); max-width: 400px; width: 90%;">
            <h2 id="accessTitle">üîí P≈ô√≠stup k aplikaci</h2>
            <p id="enterPassword">Pro spu≈°tƒõn√≠ zadejte heslo:</p>
            <input type="password" id="passwordInput" style="width: 100%; padding: 12px; font-size: 16px; border: 2px solid #4CAF50; border-radius: 8px; margin-bottom: 20px; box-sizing: border-box;" placeholder="Zadejte heslo">
            <button onclick="checkPassword()" style="padding: 12px 30px; font-size: 16px; background-color: #4CAF50; color: white; border: none; border-radius: 8px; cursor: pointer; margin-right: 10px;" id="unlockButton">Odemknout</button>
            <button onclick="showHint()" style="padding: 12px 20px; font-size: 16px; background-color: #ff9800; color: white; border: none; border-radius: 8px; cursor: pointer;" id="hintButton">N√°povƒõda</button>
            <div id="loginMessage" style="margin-top: 15px; color: red; font-weight: bold;"></div>
        </div>
    </div> 

    <!-- HLAVN√ç OBSAH -->
    <div id="quizContent" style="display: none;">
        
        <!-- MENU V√ùBƒöRU KVIZU -->
        <div id="quizMenu">
            <!-- V√ùBƒöR JAZYKA -->
            <div class="language-selector">
                <button class="language-button active" onclick="changeLanguage('cs')">ƒåesky</button>
                <button class="language-button" onclick="changeLanguage('en')">English</button>
                <button class="language-button" onclick="changeLanguage('de')">Deutsch</button>
                <button class="language-button" onclick="changeLanguage('pl')">Polski</button>
            </div>
           
            <!-- V√Ωbƒõr t√©matu -->
            <div class="theme-selector">
                <button class="theme-toggle" onclick="toggleTheme()" title="P≈ôepnout t√©ma" id="themeToggle">üåô</button>
            </div>

            <h1 id="selectQuiz">üéØ Vyber si kv√≠z</h1>
            
            <!-- ƒå√çSELN√çK PRO POƒåET OT√ÅZEK -->
            <div class="question-counter">
                <h3 id="questionCountLabel">Poƒçet ot√°zek:</h3>
                <div class="counter-display">
                    <input type="number" id="questionCountInput" class="counter-input" 
                        min="1" max="999" value="5">
                    <span id="questionCountText" class="counter-text">5</span>
                </div>
                <div>
                    <button class="counter-button" onclick="decreaseQuestionCount()">-</button>
                    <button class="counter-button max-button" onclick="setMaxQuestionCount()" id="maxButton">Max</button>
                    <button class="counter-button" onclick="increaseQuestionCount()">+</button>
                </div>
            </div>
            
            <div style="margin: 40px 0;">
                <button onclick="startQuiz('birds')" class="quiz-button" id="birdsQuizButton">üê¶ Pozn√°vej pt√°ky</button>
                <button onclick="startQuiz('flowers')" class="quiz-button" id="flowersQuizButton">üåº Pozn√°vej kvƒõtiny</button>
                <button onclick="startQuiz('korean')" class="quiz-button" id="koreanQuizButton">üá∞üá∑ Nauƒç se korejsk√° slova</button>
            </div>
            <p style="color: #666; font-style: italic;" id="moreQuizzesText">V√≠ce kv√≠z≈Ø p≈ôipravujeme...</p>
        </div>

        <!-- V√ùBƒöR SKUPIN -->
        <div id="groupSelection" class="group-selection-container">
            <div class="group-selection-content">
                <h3 id="selectGroup">Vyber skupinu:</h3>
                <div id="groupButtons" class="group-buttons-container">
                    <!-- Tlaƒç√≠tka skupin se vygeneruj√≠ dynamicky -->
                </div>
                <div class="group-selection-footer">
                    <button onclick="returnToQuizMenu()" class="menu-button">
                        ‚Üê Zpƒõt na v√Ωbƒõr kv√≠zu
                    </button>
                </div>
            </div>
        </div>

        <!-- UNIVERZ√ÅLN√ç KVIZOV√Å PLOCHA (PRO 4 ODPOVƒöDI) -->
        <div id="quizArea" style="display: none;">
            <div class="quiz-header">
                <h1 id="quizTitle">üéØ Kv√≠z</h1>
                <button class="menu-return-button" onclick="returnToMenuFromQuiz()" title="Zpƒõt do menu">üè†</button>
            </div>
            
            <div class="score-container">
                <span id="scoreText">Sk√≥re: 0</span> | 
                <span id="progressText">Ot√°zka: 1/0</span>
            </div>
            
            <div class="quiz-container">
                <img id="quizImage" class="quiz-image" src="" alt="Obr√°zek">
                
                <!-- Hint ikona -->
                <div id="hintIcon" class="hint-icon" data-title="hintButton">üí°</div>
                <div id="hintTooltip" class="hint-tooltip"></div>
                <!-- Ikona pro informace o fotce -->
                <div id="creditIcon" class="credit-icon" data-title="photoCredit">‚ÑπÔ∏è</div>
                <div id="creditTooltip" class="credit-tooltip"></div>
            </div>
            
            <div class="options">
                <button onclick="checkAnswer(0)" id="option0">Naƒç√≠t√°m...</button>
                <button onclick="checkAnswer(1)" id="option1">Naƒç√≠t√°m...</button>
                <button onclick="checkAnswer(2)" id="option2">Naƒç√≠t√°m...</button>
                <button onclick="checkAnswer(3)" id="option3">Naƒç√≠t√°m...</button>
            </div>
            
            <div id="feedback" class="feedback"></div>
        </div>

        <!-- NOV√Å KVIZOV√Å PLOCHA PRO PSAN√ç ODPOVƒöD√ç -->
        <div id="writeQuizArea" class="write-quiz-container" style="display: none;">
            <div class="quiz-header">
                <h1 id="writeQuizTitle">üéØ Kv√≠z - Psan√≠</h1>
                <button class="menu-return-button" onclick="returnToMenuFromQuiz()" title="Zpƒõt do menu">üè†</button>
            </div>
            
            <div class="score-container">
                <span id="writeScoreText">Sk√≥re: 0</span> | 
                <span id="writeProgressText">Ot√°zka: 1/0</span>
            </div>
            
            <div class="quiz-container">
                <img id="writeQuizImage" class="quiz-image" src="" alt="Obr√°zek">
                
                <!-- Hint ikona -->
                <div id="writeHintIcon" class="hint-icon" data-title="hintButton">üí°</div>
                <div id="writeHintTooltip" class="hint-tooltip"></div>
                <!-- Ikona pro informace o fotce -->
                <div id="writeCreditIcon" class="credit-icon" data-title="photoCredit">‚ÑπÔ∏è</div>
                <div id="writeCreditTooltip" class="credit-tooltip"></div>
            </div>

            <!-- Ovl√°dac√≠ tlaƒç√≠tka -->
            <div class="answer-controls">
                <button class="show-answer-button" onclick="showAnswer()" id="showAnswerButton">Odpovƒõƒè</button>
            </div>

            <!-- Zobrazen√≠ spr√°vn√© odpovƒõdi -->
            <div id="answerDisplay" class="answer-display">
                <div id="answerText" class="answer-text"></div>
                <div id="answerLatin" class="answer-latin"></div>
                <div id="answerDescription" class="answer-description"></div>
            </div>

            <!-- Tlaƒç√≠tka pro hodnocen√≠ -->
            <div id="evaluationButtons" class="evaluation-buttons">
                <button class="correct-button" onclick="evaluateAnswer(true)" id="correctButton">‚úì Spr√°vnƒõ</button>
                <button class="incorrect-button" onclick="evaluateAnswer(false)" id="incorrectButton">‚úó ≈†patnƒõ</button>
            </div>

            <!-- Pl√°tno pro kreslen√≠ -->
            <div class="drawing-container">
                <canvas id="drawingCanvas"></canvas>
            </div>
            
            <div class="drawing-tools">
                <button class="clear-button" onclick="clearCanvas()" id="clearButton">Vymazat</button>
            </div>
            
            <div id="writeFeedback" class="feedback"></div>
        </div>

        <!-- V√ùSLEDKOV√Å OBRAZOVKA (NOV√Å) -->
        <div id="quizResults">
            <!-- Obsah se dynamicky napln√≠ -->
        </div>
    </div>

    <script>
        // ==================== KONFIGURACE KVIZ≈Æ ====================
        const quizConfig = {
            'birds': {
                titleKey: 'birdsQuiz',
                dataFile: 'birds.json',
                imageField: 'images',
                nameField: 'name', // Bude dynamicky upraveno podle jazyka
                scientificField: 'latin_name',
                hintField: 'description', // Bude dynamicky upraveno podle jazyka
                groupField: 'group',
                quizType: 'options' // Nov√Ω parametr pro typ kv√≠zu
            },
            'flowers': {
                titleKey: 'flowersQuiz',
                dataFile: 'flowers.json',
                imageField: 'images', 
                nameField: 'name', // Bude dynamicky upraveno podle jazyka
                scientificField: 'latin_name',
                hintField: 'description', // Bude dynamicky upraveno podle jazyka
                groupField: 'group',
                quizType: 'options'
            },
            'korean': {
                titleKey: 'koreanQuiz',
                dataFile: 'korean.json',
                imageField: 'images',
                nameField: 'name', // Bude dynamicky upraveno podle jazyka
                scientificField: 'latin_name',
                hintField: 'description', // Bude dynamicky upraveno podle jazyka
                groupField: 'group',
                quizType: 'write' // Nov√Ω typ kv√≠zu - psan√≠ odpovƒõd√≠
            }
        };

        // ==================== GLOB√ÅLN√ç PROMƒöNN√â ====================
        let currentQuiz = null;
        let quizData = [];
        let currentItemIndex = 0;
        let score = 0;
        let totalQuestions = 0;
        let allItemNames = [];
        let remainingItems = [];
        let maxQuestions = 5;
        let currentQuizMaxQuestions = 200;
        let currentLanguage = 'cs';
        let translations = {};
        let currentGroup = null;
        let currentQuizType = 'options'; // 'options' nebo 'write'
        
        // Promƒõnn√© pro kreslen√≠
        let canvas, ctx;
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;

        // ==================== NAƒåTEN√ç P≈òEKLAD≈Æ ====================
        function loadTranslations() {
            fetch('lang.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Soubor s p≈ôeklady nebyl nalezen');
                    }
                    return response.json();
                })
                .then(data => {
                    translations = data;
                    updateUI();
                })
                .catch(error => {
                    console.error('Chyba p≈ôi naƒç√≠t√°n√≠ p≈ôeklad≈Ø:', error);
                    alert('Nelze naƒç√≠st p≈ôeklady. Kontaktujte spr√°vce.');
                })
                .then(() => {
                    loadThemePreference();
                    updateUI();
                    initCanvas(); // Inicializace canvasu pro kreslen√≠
                });
        }

        // ==================== INTERNATIONALIZACE ====================
        function changeLanguage(lang) {
            currentLanguage = lang;
            updateUI();
            
            // Aktualizovat aktivn√≠ tlaƒç√≠tko jazyka
            document.querySelectorAll('.language-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Pokud je aktivn√≠ kv√≠z, naƒç√≠st data znovu s nov√Ωm jazykem
            if (currentQuiz) {
                reloadQuizWithNewLanguage();
            }
            
            // Pokud je zobrazen v√Ωbƒõr skupin, aktualizovat skupiny
            const groupSelection = document.getElementById('groupSelection');
            if (groupSelection.style.display === 'block') {
                loadQuizDataForGroupSelection();
            }
        }

        function getText(key) {
            return translations[currentLanguage][key] || translations['cs'][key] || key;
        }

        function getNameField() {
            const fields = {
                'cs': 'name_cs',
                'en': 'name_eng', 
                'de': 'name_de',
                'pl': 'name_pl'
            };
            return fields[currentLanguage] || 'name_eng';
        }

        function getDescriptionField() {
            const fields = {
                'cs': 'description_cs',
                'en': 'description_eng',
                'de': 'description_de',
                'pl': 'description_pl'
            };
            return fields[currentLanguage] || 'description_eng';
        }

        // Funkce pro p≈ôenaƒçten√≠ kv√≠zu s nov√Ωm jazykem
        function reloadQuizWithNewLanguage() {
            if (!currentQuiz) return;
            
            // Aktualizovat konfiguraci kv√≠zu pro nov√Ω jazyk
            currentQuiz.nameField = getNameField();
            currentQuiz.hintField = getDescriptionField();
            
            // Aktualizovat n√°zev kv√≠zu
            document.getElementById('quizTitle').textContent = getText(currentQuiz.titleKey);
            document.getElementById('writeQuizTitle').textContent = getText(currentQuiz.titleKey);
            
            // Pokud m√°me naƒçten√° data, aktualizovat aktu√°ln√≠ ot√°zku
            if (quizData.length > 0 && currentItemIndex !== -1) {
                loadItem();
            }
        }

        function updateUI() {
            // Aktualizace titulku
            document.title = getText('appTitle');
            
            // P≈ôihla≈°ovac√≠ obrazovka
            document.getElementById('accessTitle').textContent = getText('accessTitle');
            document.getElementById('enterPassword').textContent = getText('enterPassword');
            document.getElementById('passwordInput').placeholder = getText('passwordPlaceholder');
            document.getElementById('unlockButton').textContent = getText('unlockButton');
            document.getElementById('hintButton').textContent = getText('hintButton');
            
            // Hlavn√≠ menu
            document.getElementById('selectQuiz').textContent = getText('selectQuiz');
            document.getElementById('questionCountLabel').textContent = getText('questionCount');
            document.getElementById('maxButton').textContent = getText('maxButton');
            document.getElementById('moreQuizzesText').textContent = getText('moreQuizzes');
            document.getElementById('birdsQuizButton').textContent = getText('birdsQuiz');
            document.getElementById('flowersQuizButton').textContent = getText('flowersQuiz');
            document.getElementById('koreanQuizButton').textContent = getText('koreanQuiz');
            
            // AKTUALIZACE TLAƒå√çTEK PRO KVIZ S PSAN√çM
            const showAnswerButton = document.getElementById('showAnswerButton');
            const clearButton = document.getElementById('clearButton');
            const correctButton = document.getElementById('correctButton');
            const incorrectButton = document.getElementById('incorrectButton');
            
            if (showAnswerButton) showAnswerButton.textContent = getText('showAnswer');
            if (clearButton) clearButton.textContent = getText('clearDrawing');
            if (correctButton) correctButton.textContent = getText('correctAnswer');
            if (incorrectButton) incorrectButton.textContent = getText('incorrectAnswer');

            // Kv√≠zov√° obrazovka
            if (currentQuiz) {
                document.getElementById('quizTitle').textContent = getText(currentQuiz.titleKey);
                document.getElementById('writeQuizTitle').textContent = getText(currentQuiz.titleKey);
            }
            
            // Naƒç√≠tac√≠ texty pro mo≈ænosti odpovƒõd√≠
            for (let i = 0; i < 4; i++) {
                document.getElementById('option' + i).textContent = getText('loading');
            }
            
            // Aktualizace tlaƒç√≠tka zpƒõt ve v√Ωbƒõru skupin
            const backButton = document.querySelector('.group-selection-footer .menu-button');
            if (backButton) {
                backButton.textContent = getText('returnToQuizSelection');
            }

            // AKTUALIZACE TITULK≈Æ IKON
            const hintIcon = document.getElementById('hintIcon');
            const creditIcon = document.getElementById('creditIcon');
            const writeHintIcon = document.getElementById('writeHintIcon');
            const writeCreditIcon = document.getElementById('writeCreditIcon');
                    
            if (hintIcon) {
                hintIcon.title = getText('hintButton');
            }
            if (creditIcon) {
                creditIcon.title = getText('photoCredit');
            }
            if (writeHintIcon) {
                writeHintIcon.title = getText('hintButton');
            }
            if (writeCreditIcon) {
                writeCreditIcon.title = getText('photoCredit');
            }
                    
            // Aktualizace v√Ωbƒõru skupin
            document.getElementById('selectGroup').textContent = getText('selectGroup');
                    
            updateStats();
                    
            // Aktualizuj text tlaƒç√≠tka t√©matu
            const themeToggle = document.getElementById('themeToggle');
            if (themeToggle) {
                themeToggle.title = currentTheme === 'light' ? getText('darkMode') : getText('lightMode');
            }
        }
        
        // ==================== SPR√ÅVA T√âMAT ====================
        let currentTheme = 'light';

        function toggleTheme() {
            const themeToggle = document.getElementById('themeToggle');
            
            if (currentTheme === 'light') {
                // P≈ôepni na tmav√© t√©ma
                document.documentElement.setAttribute('data-theme', 'dark');
                themeToggle.textContent = '‚òÄÔ∏è';
                themeToggle.title = getText('lightMode');
                currentTheme = 'dark';
            } else {
                // P≈ôepni na svƒõtl√© t√©ma
                document.documentElement.removeAttribute('data-theme');
                themeToggle.textContent = 'üåô';
                themeToggle.title = getText('darkMode');
                currentTheme = 'light';
            }
            
            // Ulo≈æ preferenci do localStorage
            localStorage.setItem('theme', currentTheme);
        }

        function loadThemePreference() {
            const savedTheme = localStorage.getItem('theme');
            const themeToggle = document.getElementById('themeToggle');
            
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                themeToggle.textContent = '‚òÄÔ∏è';
                themeToggle.title = getText('lightMode');
                currentTheme = 'dark';
            } else {
                themeToggle.textContent = 'üåô';
                themeToggle.title = getText('darkMode');
                currentTheme = 'light';
            }
        }

        // ==================== P≈òIHL√Å≈†EN√ç ====================
        let loginScreen = document.getElementById('loginScreen');
        let quizContent = document.getElementById('quizContent');
        
        function autoLogin() {
            loginScreen.style.display = 'none';
            quizContent.style.display = 'block';
            loadTranslations();
        }        

        function checkPassword() {
            // Pokud je heslo vypnuto, pou≈æijte autoLogin
            if (isPasswordDisabled) {
                autoLogin();
                return;
            }
            
            const passwordInput = document.getElementById('passwordInput').value;
            const messageDiv = document.getElementById('loginMessage');
                
            fetch('password.txt')
                .then(response => {
                    if (!response.ok) throw new Error('Soubor s heslem nenalezen');
                    return response.text();
                })
                .then(correctPassword => {
                    if (passwordInput === correctPassword.trim()) {
                        loginScreen.style.display = 'none';
                        quizContent.style.display = 'block';
                        loadTranslations();
                    } else {
                        messageDiv.textContent = getText('incorrectPassword');
                        document.getElementById('passwordInput').value = '';
                        document.getElementById('passwordInput').focus();
                    }
                })
                .catch(error => {
                    messageDiv.textContent = getText('systemError');
                });
        }

        function showHint() {
            document.getElementById('loginMessage').textContent = getText('hintMessage');
        }

        document.getElementById('passwordInput').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') checkPassword();
        });

        // P≈ôidejte promƒõnnou pro vypnut√≠ hesla
        let isPasswordDisabled = true; // Nastavte na false pro zapnut√≠ hesla

        // ==================== FUNKCE PRO ƒå√çSELN√çK ====================
        let isEditingCount = false;

        function updateQuestionCountDisplay() {
            const display = document.getElementById('questionCountDisplay');
            const input = document.getElementById('questionCountInput');
            const text = document.getElementById('questionCountText');
            
            if (maxQuestions === 'max') {
                text.textContent = getText('maxButton');
                input.style.display = 'none';
                text.style.display = 'inline-block';
            } else {
                text.textContent = maxQuestions;
                input.value = maxQuestions;
                input.style.display = 'none';
                text.style.display = 'inline-block';
            }
        }

        function enableCountEditing() {
            if (maxQuestions === 'max') return;
            
            const input = document.getElementById('questionCountInput');
            const text = document.getElementById('questionCountText');
            
            input.style.display = 'inline-block';
            text.style.display = 'none';
            input.focus();
            input.select();
            isEditingCount = true;
            
            // P≈ôid√°me listener pro kliknut√≠ mimo input
            setTimeout(() => {
                document.addEventListener('click', outsideClickListener);
            }, 10);
        }

        function outsideClickListener(event) {
            const input = document.getElementById('questionCountInput');
            const text = document.getElementById('questionCountText');
            
            if (!input.contains(event.target) && !text.contains(event.target)) {
                updateQuestionCountFromInput();
                document.removeEventListener('click', outsideClickListener);
            }
        }

        function disableCountEditing() {
            const input = document.getElementById('questionCountInput');
            const text = document.getElementById('questionCountText');
            
            input.style.display = 'none';
            text.style.display = 'inline-block';
            isEditingCount = false;
        }

        function updateQuestionCountFromInput() {
            const input = document.getElementById('questionCountInput');
            let value = parseInt(input.value);
            
            if (isNaN(value) || value < 1) {
                value = 1;
            } else if (value > 999) { // Zv√Ω≈°eno maximum
                value = 999;
            }
            
            maxQuestions = value;
            updateQuestionCountDisplay();
            disableCountEditing();
            
            // Odstranƒõn√≠ listeneru
            document.removeEventListener('click', outsideClickListener);
        }

        function handleInputKeydown(event) {
            if (event.key === 'Enter') {
                updateQuestionCountFromInput();
                document.removeEventListener('click', outsideClickListener);
            } else if (event.key === 'Escape') {
                disableCountEditing();
                // Obnov p≈Øvodn√≠ hodnotu
                const input = document.getElementById('questionCountInput');
                input.value = maxQuestions === 'max' ? currentQuizMaxQuestions : maxQuestions;
                document.removeEventListener('click', outsideClickListener);
            }
        }

        function decreaseQuestionCount() {
            if (isEditingCount) return;
            
            if (maxQuestions === 'max') {
                maxQuestions = currentQuizMaxQuestions;
            } else if (maxQuestions > 1) {
                maxQuestions--;
            }
            updateQuestionCountDisplay();
        }

        function increaseQuestionCount() {
            if (isEditingCount) return;
            
            if (maxQuestions === 'max') {
                maxQuestions = 1;
            } else if (maxQuestions < currentQuizMaxQuestions) {
                maxQuestions++;
            }
            updateQuestionCountDisplay();
        }

        function setMaxQuestionCount() {
            if (isEditingCount) return;
            
            maxQuestions = 'max';
            updateQuestionCountDisplay();
        }

        function resetQuestionCount() {
            maxQuestions = 5; // V√Ωchoz√≠ hodnota
            updateQuestionCountDisplay();
        }

        // P≈ôidej event listener pro kliknut√≠ na text
        document.addEventListener('DOMContentLoaded', function() {
            const questionCountText = document.getElementById('questionCountText');
            const questionCountInput = document.getElementById('questionCountInput');
            
            if (questionCountText) {
                questionCountText.addEventListener('click', enableCountEditing);
            }
            
            if (questionCountInput) {
                questionCountInput.addEventListener('change', updateQuestionCountFromInput);
                questionCountInput.addEventListener('keydown', handleInputKeydown);
                questionCountInput.addEventListener('blur', updateQuestionCountFromInput);
            }
        });

        // ==================== FUNKCE PRO SKUPINY ====================
        function startQuiz(quizType) {
            console.log('Start kv√≠zu:', quizType);
            
            // Reset stavu
            resetQuizState();
            
            // Vyƒçistit feedback
            const feedback = document.getElementById('feedback');
            const writeFeedback = document.getElementById('writeFeedback');
            if (feedback) {
                feedback.innerHTML = '';
                feedback.className = 'feedback';
            }
            if (writeFeedback) {
                writeFeedback.innerHTML = '';
                writeFeedback.className = 'feedback';
            }

            currentQuiz = quizConfig[quizType];
            if (!currentQuiz) {
                alert('Kv√≠z nen√≠ nakonfigurov√°n!');
                return;
            }

            // Nastavit typ kv√≠zu
            currentQuizType = currentQuiz.quizType || 'options';

            // Nastavit spr√°vn√° jazykov√° pole
            currentQuiz.nameField = getNameField();
            currentQuiz.hintField = getDescriptionField();

            // Skr√Ωt menu, zobrazit v√Ωbƒõr skupin
            document.getElementById('quizMenu').style.display = 'none';
            document.getElementById('quizResults').style.display = 'none';
            document.getElementById('quizArea').style.display = 'none';
            document.getElementById('writeQuizArea').style.display = 'none';
            document.getElementById('groupSelection').style.display = 'block';

            // Naƒç√≠st data pro zobrazen√≠ skupin
            loadQuizDataForGroupSelection();
        }

        function loadQuizDataForGroupSelection() {
            if (!currentQuiz) {
                console.error('currentQuiz je null');
                return;
            }

            console.log('Naƒç√≠t√°m data pro v√Ωbƒõr skupin z:', currentQuiz.dataFile);
            
            fetch(currentQuiz.dataFile)
                .then(response => {
                    if (!response.ok) throw new Error(`Soubor ${currentQuiz.dataFile} nebyl nalezen`);
                    return response.json();
                })
                .then(data => {
                    console.log('Data √∫spƒõ≈°nƒõ naƒçtena pro v√Ωbƒõr skupin', data);
                    
                    const metadata = data.metadata;
                    if (!metadata || !metadata.quizGroups) {
                        console.error('Chyb√≠ metadata nebo quizGroups v JSONu');
                        document.getElementById('groupButtons').innerHTML = '<p style="color: red;">‚ùå Chyba: ≈†patn√° struktura JSON souboru</p>';
                        return;
                    }
                    
                    const groups = metadata.quizGroups;
                    
                    // Z√≠skat pole polo≈æek pro kontrolu poƒçtu
                    const possibleKeys = Object.keys(data).filter(key => key !== 'metadata');
                    let itemsArray;
                    if (possibleKeys.length > 0) {
                        itemsArray = data[possibleKeys[0]]; // birds, flowers, atd.
                    } else {
                        itemsArray = data.items || data.birds || data;
                    }
                    
                    console.log('Naƒçteno polo≈æek:', itemsArray.length);
                    
                    // Vytvo≈ôit tlaƒç√≠tka skupin
                    createGroupButtons(groups, itemsArray);
                })
                .catch(error => {
                    console.error('Chyba p≈ôi naƒç√≠t√°n√≠ dat:', error);
                    document.getElementById('groupButtons').innerHTML = `<p style="color: red;">‚ùå Chyba: ${error.message}</p>`;
                });
        }

        function createGroupButtons(groups, itemsArray) {
            const groupButtonsContainer = document.getElementById('groupButtons');
            groupButtonsContainer.innerHTML = '';
            
            console.log('Vytv√°≈ô√≠m tlaƒç√≠tka pro skupiny:', groups);
            console.log('Celkem polo≈æek:', itemsArray.length);
            
            // POJISTKA: Zkontrolovat, zda m√°me dostatek polo≈æek pro skupiny
            const validGroups = {};
            
            for (const [groupId, groupData] of Object.entries(groups)) {
                // Z√≠skat n√°zev skupiny v aktu√°ln√≠m jazyce
                const groupName = typeof groupData === 'object' ? 
                    (groupData[currentLanguage] || groupData['cs'] || groupId) : 
                    groupData;
                    
                const groupItems = itemsArray.filter(item => 
                    item.groups && item.groups.includes(groupId)
                );
                console.log(`Skupina ${groupName} (${groupId}): ${groupItems.length} polo≈æek`);
                
                // POJISTKA: Zobrazit pouze skupiny s alespo≈à 4 polo≈ækami
                if (groupItems.length >= 4) {
                    validGroups[groupId] = groupName;
                } else {
                    console.warn(`Skupina ${groupName} m√° pouze ${groupItems.length} polo≈æek - p≈ôeskoƒçena`);
                }
            }
            
            console.log('Validn√≠ skupiny:', validGroups);
            
            // P≈ôidat tlaƒç√≠tko "V≈°echny polo≈æky" s p≈ôekladem
            const allItemsButton = document.createElement('button');
            allItemsButton.textContent = getText('allItems') + ' (' + itemsArray.length + ')';
            allItemsButton.onclick = () => startGroupQuiz(null);
            groupButtonsContainer.appendChild(allItemsButton);
            
            // P≈ôidat tlaƒç√≠tka pro jednotliv√© skupiny
            for (const [groupId, groupName] of Object.entries(validGroups)) {
                const groupItems = itemsArray.filter(item => 
                    item.groups && item.groups.includes(groupId)
                );
                const button = document.createElement('button');
                button.textContent = `${groupName} (${groupItems.length})`;
                button.onclick = () => startGroupQuiz(groupId);
                groupButtonsContainer.appendChild(button);
            }
            
            // Aktualizovat tlaƒç√≠tko zpƒõt
            const backButton = document.querySelector('.group-selection-footer .menu-button');
            if (backButton) {
                backButton.textContent = getText('returnToQuizSelection');
            }
            
            // Pokud nejsou ≈æ√°dn√© validn√≠ skupiny, zobrazit zpr√°vu
            if (Object.keys(validGroups).length === 0) {
                groupButtonsContainer.innerHTML = `<div style="text-align: center; padding: 30px;">
                    <p style="color: #666; font-style: italic; margin-bottom: 20px;">
                        ≈Ω√°dn√© skupiny s dostateƒçn√Ωm poƒçtem polo≈æek (minim√°lnƒõ 4)
                    </p>
                    <button onclick="startGroupQuiz(null)" style="padding: 15px 25px; font-size: 16px; background-color: var(--primary-color); color: white; border: none; border-radius: 10px; cursor: pointer;">
                        ${getText('allItems')} (${itemsArray.length})
                    </button>
                </div>`;
            }
        }

        function startGroupQuiz(groupId) {
            currentGroup = groupId;
            console.log(`Spou≈°t√≠m kv√≠z pro skupinu: ${groupId}`);
            
            // Skr√Ωt v√Ωbƒõr skupin, zobrazit spr√°vn√Ω typ kv√≠zu
            document.getElementById('groupSelection').style.display = 'none';
            
            if (currentQuizType === 'write') {
                document.getElementById('writeQuizArea').style.display = 'block';
                document.getElementById('writeQuizTitle').textContent = getText(currentQuiz.titleKey);
                
                // INICIALIZACE CANVASU P≈òI ZOBRAZEN√ç KVIZU S PSAN√çM
                setTimeout(() => {
                    console.log("Initializing canvas for write quiz");
                    initCanvas();
                }, 100);
            } else {
                document.getElementById('quizArea').style.display = 'block';
                document.getElementById('quizTitle').textContent = getText(currentQuiz.titleKey);
            }
            
            // Naƒç√≠st data pro kv√≠z s filtrac√≠ skupiny
            loadQuizDataForQuiz();
        }

        function loadQuizDataForQuiz() {
            if (!currentQuiz) {
                console.error('currentQuiz je null');
                return;
            }

            console.log('Naƒç√≠t√°m data pro kv√≠z s filtrac√≠ skupiny:', currentGroup);
            
            fetch(currentQuiz.dataFile)
                .then(response => {
                    if (!response.ok) throw new Error(`Soubor ${currentQuiz.dataFile} nebyl nalezen`);
                    return response.json();
                })
                .then(data => {
                    console.log('Data √∫spƒõ≈°nƒõ naƒçtena pro kv√≠z');
                    
                    let itemsArray;
                    const possibleKeys = Object.keys(data).filter(key => key !== 'metadata');
                    if (possibleKeys.length > 0) {
                        itemsArray = data[possibleKeys[0]];
                    } else {
                        itemsArray = data.items || data.birds || data;
                    }
                    
                    console.log('Celkem polo≈æek p≈ôed filtrac√≠:', itemsArray.length);
                    
                    // FILTRACE PODLE SKUPINY
                    if (currentGroup !== null) {
                        if (currentGroup !== null) {
                            quizData = itemsArray.filter(item => 
                                item.groups && item.groups.includes(currentGroup)
                            );
                        } else {
                            quizData = itemsArray;
                        }
                        console.log(`Filtrov√°no na skupinu ${currentGroup}: ${quizData.length} polo≈æek`);
                    } else {
                        quizData = itemsArray; // V≈°echny polo≈æky
                        console.log(`Pou≈æ√≠v√°m v≈°echny polo≈æky: ${quizData.length} polo≈æek`);
                    }
                    
                    // POJISTKA: Pokud je m√©nƒõ ne≈æ 4 polo≈æky, nelze spustit kv√≠z
                    if (quizData.length < 4) {
                        alert(`Pro tuto skupinu je k dispozici pouze ${quizData.length} polo≈æek. Kv√≠z vy≈æaduje alespo≈à 4 polo≈æky.`);
                        returnToGroupSelection();
                        return;
                    }
                    
                    // Nastavit maxim√°ln√≠ poƒçet ot√°zek pro aktu√°ln√≠ kv√≠z
                    currentQuizMaxQuestions = quizData.length;
                    
                    // Pokud je nastaveno "max", pou≈æijeme v≈°echny ot√°zky
                    if (maxQuestions === 'max') {
                        totalQuestions = currentQuizMaxQuestions;
                    } else {
                        totalQuestions = Math.min(maxQuestions, 999);
                    }
                    
                    allItemNames = quizData.map(item => item[currentQuiz.nameField]);
                    
                    console.log(`Spou≈°t√≠m kv√≠z s ${totalQuestions} ot√°zkami`);
                    
                    // Vytvo≈ôit seznam ot√°zek
                    remainingItems = createQuestionSet(totalQuestions, quizData);
                    
                    currentItemIndex = getNextRandomItem();
                    loadItem();
                })
                .catch(error => {
                    console.error('Chyba p≈ôi naƒç√≠t√°n√≠ dat:', error);
                    document.getElementById('feedback').innerHTML = `‚ùå Chyba: ${currentQuiz.dataFile} nenalezen`;
                });
        }

        function returnToGroupSelection() {
            document.getElementById('quizArea').style.display = 'none';
            document.getElementById('writeQuizArea').style.display = 'none';
            document.getElementById('quizResults').style.display = 'none';
            document.getElementById('groupSelection').style.display = 'block';
        }

        function returnToQuizMenu() {
            document.getElementById('groupSelection').style.display = 'none';
            document.getElementById('quizMenu').style.display = 'block';
            currentGroup = null;
        }

        // ==================== UNIVERZ√ÅLN√ç KVIZOV√â FUNKCE ====================
        function resetQuizState() {
            console.log('Resetuji stav kv√≠zu');
            quizData = [];
            currentItemIndex = 0;
            score = 0;
            totalQuestions = 0;
            allItemNames = [];
            remainingItems = [];
            currentGroup = null;
        }

        function loadItem() {
            if (quizData.length === 0 || currentItemIndex === -1) return;
            
            const item = quizData[currentItemIndex];
            const images = item[currentQuiz.imageField];
            
            let randomImage;
            if (Array.isArray(images)) {
                if (images.length === 0) {
                    console.error(`≈Ω√°dn√© obr√°zky pro: ${item[currentQuiz.nameField]}`);
                    randomImage = "placeholder.jpg";
                } else {
                    randomImage = images[Math.floor(Math.random() * images.length)];
                }
            } else {
                randomImage = images;
            }
            
            // Naƒç√≠st obr√°zek pro oba typy kv√≠z≈Ø
            document.getElementById('quizImage').src = randomImage;
            document.getElementById('quizImage').alt = item[currentQuiz.nameField];
            document.getElementById('writeQuizImage').src = randomImage;
            document.getElementById('writeQuizImage').alt = item[currentQuiz.nameField];
            
            // Naplnit hint (p≈Øvodn√≠ funkce)
            const hint = item[currentQuiz.hintField];
            document.getElementById('hintTooltip').textContent = hint || getText('hintNotAvailable');
            document.getElementById('writeHintTooltip').textContent = hint || getText('hintNotAvailable');
            
            // NAƒå√çST A NASTAVIT CREDIT INFORMACE
            const creditInfo = getImageCredit(item, randomImage);
            document.getElementById('creditTooltip').textContent = creditInfo;
            document.getElementById('writeCreditTooltip').textContent = creditInfo;
            
            // Pro kv√≠z s mo≈ænostmi
            if (currentQuizType === 'options') {
                const randomOptions = getRandomOptions(item);
                const buttons = document.querySelectorAll('.options button');
                randomOptions.forEach((option, index) => {
                    buttons[index].innerHTML = option.displayText;
                    buttons[index].dataset.itemName = option.itemName;
                });
                
                item.currentCorrectIndex = randomOptions.findIndex(opt => opt.isCorrect);
            }
            
            // Pro kv√≠z s psan√≠m - resetovat stav
            if (currentQuizType === 'write') {
                resetWriteQuizState();
            }
            
            updateStats();
        }

        // Resetovat stav kv√≠zu s psan√≠m
        function resetWriteQuizState() {
            document.getElementById('answerDisplay').style.display = 'none';
            document.getElementById('evaluationButtons').style.display = 'none';
            document.getElementById('writeQuizImage').style.display = 'block';
            document.getElementById('writeHintIcon').style.display = 'block';
            document.getElementById('writeCreditIcon').style.display = 'block';
            document.getElementById('writeFeedback').innerHTML = '';
            document.getElementById('writeFeedback').className = 'feedback';
            clearCanvas();
        }

        // Z√≠skat licenƒçn√≠ informace pro obr√°zek
        function getImageCredit(item, imagePath) {
            if (!item.image_credits) {
                return getText('creditNotAvailable');
            }
            
            // Extrahovat n√°zev souboru z cesty
            const fileName = imagePath.split('/').pop();
            
            if (item.image_credits[fileName]) {
                return item.image_credits[fileName];
            } else {
                return getText('creditNotAvailable');
            }
        }

        function getRandomOptions(correctItem) {
            const options = [{
                displayText: `${correctItem[currentQuiz.nameField]}<span class="scientific-name">${correctItem[currentQuiz.scientificField] || ''}</span>`,
                isCorrect: true,
                itemName: correctItem[currentQuiz.nameField]
            }];
            
            while (options.length < 4) {
                const randomIndex = Math.floor(Math.random() * allItemNames.length);
                const randomItemName = allItemNames[randomIndex];
                const randomItemData = quizData.find(item => item[currentQuiz.nameField] === randomItemName);
                
                const alreadyExists = options.some(opt => opt.itemName === randomItemName);
                if (!alreadyExists && randomItemName !== correctItem[currentQuiz.nameField]) {
                    options.push({
                        displayText: `${randomItemName}<span class="scientific-name">${randomItemData[currentQuiz.scientificField] || ''}</span>`,
                        isCorrect: false,
                        itemName: randomItemName
                    });
                }
            }
            
            return shuffleArray(options);
        }

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function getNextRandomItem() {
            if (remainingItems.length === 0) return -1;
            
            // Bereme postupnƒõ od zaƒç√°tku (doporuƒçeno)
            const nextItem = remainingItems[0];
            remainingItems.shift(); // Odstranit prvn√≠ polo≈æku

            
            return quizData.findIndex(item => item === nextItem);
        }

        // Vytvo≈ô√≠ seznam ot√°zek s opakov√°n√≠m pokud je pot≈ôeba
        function createQuestionSet(requestedCount, availableItems) {
            if (requestedCount <= availableItems.length) {
                // Pokud je po≈æadovan√Ω poƒçet men≈°√≠ nebo rovn√Ω poƒçtu dostupn√Ωch polo≈æek
                return shuffleArray([...availableItems]).slice(0, requestedCount);
            } else {
                // Pokud je po≈æadovan√Ω poƒçet vƒõt≈°√≠ ne≈æ poƒçet dostupn√Ωch polo≈æek
                const result = [];
                const availableCount = availableItems.length;
                
                // Kolikr√°t se vejce cel√Ω dataset
                const fullCycles = Math.floor(requestedCount / availableCount);
                // Zb√Ωvaj√≠c√≠ poƒçet ot√°zek
                const remainder = requestedCount % availableCount;
                
                console.log(`Vytv√°≈ô√≠m set: ${requestedCount} ot√°zek z ${availableCount} polo≈æek`);
                console.log(`Pln√© cykly: ${fullCycles}, Zbytek: ${remainder}`);
                
                // P≈ôidat pln√© cykly
                for (let i = 0; i < fullCycles; i++) {
                    const shuffledBatch = shuffleArray([...availableItems]);
                    result.push(...shuffledBatch);
                }
                
                // P≈ôidat zb√Ωvaj√≠c√≠ ot√°zky
                if (remainder > 0) {
                    const remainingBatch = shuffleArray([...availableItems]).slice(0, remainder);
                    result.push(...remainingBatch);
                }
                
                console.log(`Vytvo≈ôen set s ${result.length} ot√°zkami`);
                return result;
            }
        }

        function checkAnswer(selectedIndex) {
            if (quizData.length === 0) return;
            
            const feedback = document.getElementById('feedback');
            const item = quizData[currentItemIndex];
            const correctIndex = item.currentCorrectIndex;
            const buttons = document.querySelectorAll('.options button');
            
            buttons.forEach(btn => btn.disabled = true);
            
            const selectedItemName = buttons[selectedIndex].dataset.itemName;
            const isCorrect = selectedItemName === item[currentQuiz.nameField];
            
            if (isCorrect) {
                feedback.innerHTML = getText('correct');
                feedback.className = 'feedback correct';
                score++;
            } else {
                const scientificName = item[currentQuiz.scientificField] ? `<span style="font-style: italic">${item[currentQuiz.scientificField]}</span>` : '';
                feedback.innerHTML = `${getText('incorrect')} ${item[currentQuiz.nameField]} ${scientificName}`;
                feedback.className = 'feedback incorrect';
                
                buttons[correctIndex].style.backgroundColor = '#2e7d32';
                buttons[selectedIndex].style.backgroundColor = '#c62828';
            }
            
            const delayTime = isCorrect ? 800 : 2000;
            setTimeout(() => {
                buttons.forEach(btn => {
                    btn.style.backgroundColor = '';
                    btn.disabled = false;
                });
                
                currentItemIndex = getNextRandomItem();
                if (currentItemIndex === -1) {
                    showQuizResults();
                } else {
                    loadItem();
                    feedback.innerHTML = '';
                    feedback.className = 'feedback';
                }
            }, delayTime);
            
            updateStats();
        }

        // ==================== FUNKCE PRO KRESLEN√ç - MINIM√ÅLN√ç FUNKƒåN√ç VERZE ====================
        function initCanvas() {
            canvas = document.getElementById('drawingCanvas');
            ctx = canvas.getContext('2d');
            
            const container = canvas.parentElement;
            canvas.width = container.offsetWidth;
            canvas.height = 200;
            
            // Inicializace b√≠l√©ho pozad√≠
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Styl kreslen√≠ - ZV√ù≈†IT ≈†√ç≈òKU ƒå√ÅRY
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 3; // Zv√Ω≈°eno z 5 na 8 pro lep≈°√≠ viditelnost
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round'; // D≈ÆLE≈ΩIT√â: P≈ôid√°no pro plynulej≈°√≠ kreslen√≠
            
            // Event listeners pro my≈°
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Event listeners pro dotykov√° za≈ô√≠zen√≠
            canvas.addEventListener('touchstart', handleTouchStart);
            canvas.addEventListener('touchmove', handleTouchMove);
            canvas.addEventListener('touchend', stopDrawing);
        }

        // Pomocn√© funkce pro z√≠sk√°n√≠ pozice
        function getMousePos(e) {
            const rect = canvas.getBoundingClientRect();
            return {
                x: e.clientX - rect.left,
                y: e.clientY - rect.top
            };
        }

        function getTouchPos(e) {
            const rect = canvas.getBoundingClientRect();
            return {
                x: e.touches[0].clientX - rect.left,
                y: e.touches[0].clientY - rect.top
            };
        }

        // Funkce pro kreslen√≠
        function startDrawing(e) {
            isDrawing = true;
            const pos = e.type.includes('touch') ? getTouchPos(e) : getMousePos(e);
            [lastX, lastY] = [pos.x, pos.y];
            
            // Zaƒç√°tek nov√© cesty
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            
            e.preventDefault(); // D≈Øle≈æit√© pro touch za≈ô√≠zen√≠
        }

        function draw(e) {
            if (!isDrawing) return;
            
            const pos = e.type.includes('touch') ? getTouchPos(e) : getMousePos(e);
            const x = pos.x;
            const y = pos.y;
            
            // Kreslen√≠ ƒç√°ry
            ctx.lineTo(x, y);
            ctx.stroke();
            
            [lastX, lastY] = [x, y];
            
            e.preventDefault(); // D≈Øle≈æit√© pro touch za≈ô√≠zen√≠
        }

        function stopDrawing() {
            isDrawing = false;
        }

        // Touch event handlers
        function handleTouchStart(e) {
            startDrawing(e);
        }

        function handleTouchMove(e) {
            draw(e);
        }

        function clearCanvas() {
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        // ==================== FUNKCE PRO KVIZ S PSAN√çM ====================
        function showAnswer() {
            const item = quizData[currentItemIndex];
            
            // Skr√Ωt obr√°zek a ikony
            document.getElementById('writeQuizImage').style.display = 'none';
            document.getElementById('writeHintIcon').style.display = 'none';
            document.getElementById('writeCreditIcon').style.display = 'none';
            
            // Zobrazit spr√°vnou odpovƒõƒè
            document.getElementById('answerText').textContent = item[currentQuiz.nameField];
            document.getElementById('answerLatin').textContent = item[currentQuiz.scientificField] || '';
            document.getElementById('answerDescription').textContent = item[currentQuiz.hintField] || '';
            document.getElementById('answerDisplay').style.display = 'block';
            
            // Zobrazit tlaƒç√≠tka pro hodnocen√≠
            document.getElementById('evaluationButtons').style.display = 'flex';
        }

        function evaluateAnswer(isCorrect) {
            const feedback = document.getElementById('writeFeedback');
            const item = quizData[currentItemIndex];
            
            if (isCorrect) {
                feedback.innerHTML = getText('correct');
                feedback.className = 'feedback correct';
                score++;
            } else {
                // Z√≠skat spr√°vnou odpovƒõƒè v aktu√°ln√≠m jazyce
                const correctAnswer = item[currentQuiz.nameField];
                const scientificName = item[currentQuiz.scientificField] ? 
                    `<span style="font-style: italic">${item[currentQuiz.scientificField]}</span>` : '';
                
                // Vytvo≈ôit kompletn√≠ zpr√°vu se spr√°vnou odpovƒõd√≠
                feedback.innerHTML = `${getText('incorrect')} <strong>${correctAnswer}</strong> ${scientificName}`;
                feedback.className = 'feedback incorrect';
            }
            
            updateStats();
            
            // P≈ôechod na dal≈°√≠ ot√°zku po zpo≈ædƒõn√≠
            setTimeout(() => {
                currentItemIndex = getNextRandomItem();
                if (currentItemIndex === -1) {
                    showQuizResults();
                } else {
                    loadItem();
                    feedback.innerHTML = '';
                    feedback.className = 'feedback';
                }
            }, 1500);
        }

        function showQuizResults() {
            const percentage = Math.round((score / totalQuestions) * 100);
            
            // Skr√Ωt kv√≠z, zobrazit v√Ωsledky
            document.getElementById('quizArea').style.display = 'none';
            document.getElementById('writeQuizArea').style.display = 'none';
            document.getElementById('quizResults').style.display = 'block';
            document.getElementById('quizResults').innerHTML = `
                <h1>${getText('quizCompleted')}</h1>
                <div style="font-size: 24px; margin: 30px 0;">
                    <p>${getText('result')} <strong>${score} / ${totalQuestions}</strong></p>
                    <p>${getText('successRate')} <strong>${percentage}%</strong></p>
                </div>
                <div style="margin-top: 30px;">
                    <button onclick="restartCurrentQuiz()" class="result-button restart-button">
                        ${getText('restartQuiz')}
                    </button>
                    <button onclick="returnToMenu()" class="result-button menu-button">
                        ${getText('backToMenu')}
                    </button>
                </div>
            `;
        }

        function restartCurrentQuiz() {
            console.log('Restartuji aktu√°ln√≠ kv√≠z');
            
            // Reset promƒõnn√Ωch
            currentItemIndex = 0;
            score = 0;
            
            // Znovu vytvo≈ôit seznam ot√°zek s aktu√°ln√≠m nastaven√≠m
            if (maxQuestions === 'max') {
                totalQuestions = currentQuizMaxQuestions;
            } else {
                totalQuestions = Math.min(maxQuestions, 999);
            }
            
            // Pou≈æ√≠t novou logiku pro vytvo≈ôen√≠ question setu
            remainingItems = createQuestionSet(totalQuestions, quizData);
            
            // Vyƒçistit feedback zpr√°vu
            const feedback = document.getElementById('feedback');
            const writeFeedback = document.getElementById('writeFeedback');
            if (feedback) {
                feedback.innerHTML = '';
                feedback.className = 'feedback';
            }
            if (writeFeedback) {
                writeFeedback.innerHTML = '';
                writeFeedback.className = 'feedback';
            }
            
            // Tak√© resetovat barvy tlaƒç√≠tek pro jistotu
            const buttons = document.querySelectorAll('.options button');
            buttons.forEach(btn => {
                btn.style.backgroundColor = '';
                btn.disabled = false;
            });
            
            // Skr√Ωt v√Ωsledky, zobrazit spr√°vn√Ω typ kv√≠zu
            document.getElementById('quizResults').style.display = 'none';
            
            if (currentQuizType === 'write') {
                document.getElementById('writeQuizArea').style.display = 'block';
            } else {
                document.getElementById('quizArea').style.display = 'block';
            }
            
            // Naƒç√≠st prvn√≠ polo≈æku
            currentItemIndex = getNextRandomItem();
            loadItem();
        }

        function returnToMenu() {
            console.log('N√°vrat do menu');
            
            // Reset stavu
            resetQuizState();
            
            // Skr√Ωt v≈°e, zobrazit menu
            document.getElementById('quizArea').style.display = 'none';
            document.getElementById('writeQuizArea').style.display = 'none';
            document.getElementById('quizResults').style.display = 'none';
            document.getElementById('groupSelection').style.display = 'none';
            document.getElementById('quizMenu').style.display = 'block';

            resetQuestionCount()
        }

        // N√°vrat do menu p≈ô√≠mo z kv√≠zu
        function returnToMenuFromQuiz() {
            if (confirm(getText('confirmExit'))) {
                returnToMenu();
                
                resetQuestionCount()
            }
        }

        function updateStats() {
            const currentQuestionNumber = totalQuestions - remainingItems.length;
            document.getElementById('scoreText').textContent = `${getText('score')} ${score}`;
            document.getElementById('progressText').textContent = `${getText('question')} ${currentQuestionNumber}/${totalQuestions}`;
            document.getElementById('writeScoreText').textContent = `${getText('score')} ${score}`;
            document.getElementById('writeProgressText').textContent = `${getText('question')} ${currentQuestionNumber}/${totalQuestions}`;
        }

        // Naƒçten√≠ p≈ôeklad≈Ø p≈ôi startu
        loadTranslations();

        document.addEventListener('DOMContentLoaded', function() {
            if (isPasswordDisabled) {
                autoLogin();
            }
        });
    </script>
</body>
</html>
